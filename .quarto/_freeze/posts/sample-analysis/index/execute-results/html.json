{
  "hash": "db451645a5b00081012cd5c0e6437a41",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"DepMap Autoencoder Analysis\"\nauthor: \"Jay Chung\"\ndate: \"2025-11-27\"\ncategories: [R, Bioinformatics, Autoencoder]\nformat:\n  html:\n    code-fold: true\n---\n\nThis post demonstrates how to use an autoencoder to embed DepMap genomics data using the `h2o` package in R.\n\n## Setup\n\nFirst, we load the necessary libraries and set up the directory structure.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(ggpubr)\nlibrary(h2o)\n\n# Note: Adjust paths as needed for your environment\n# setwd(\"~/Google Drive/My Drive/JCBC/Projects/20251120_DepMap_Autoencoder/\")\ndir.create(\"./results/plots\", recursive = TRUE, showWarnings = FALSE)\ndir.create(\"./results/output_files\", recursive = TRUE, showWarnings = FALSE)\ndir.create(\"./data\", recursive = TRUE, showWarnings = FALSE)\ndir.create(\"./codes\", recursive = TRUE, showWarnings = FALSE)\n```\n:::\n\n\n## Data Loading and Preprocessing\n\nWe load the RNA expression data and filter for high variance genes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Note: These paths are specific to the local environment and may need adjustment\n# setwd(\"~/Library/CloudStorage/GoogleDrive-jaychung0524@gmail.com/My Drive/JCBC/Light_Horse/Bioinformatics/tools/DepMap_24Q2\")\nload(\"CCLE_24Q2_GE_match_sample_info.RData\")\nload(\"sample_info_match_biomarkers.RData\")\n\n# remove low variance genes\nge_var <- apply(ccle_ge_match_sam, 2, var, na.rm = TRUE) # calculate variance for each gene\nplot(density(ge_var)) # plot variance density plot\nabline(v = quantile(ge_var, 0.2)) # select a cutoff\nsum(ge_var > quantile(ge_var, 0.2)) # how many genes passed variance cutoff: 15322\nge_dat_hv <- ccle_ge_match_sam[, which(ge_var > quantile(ge_var, 0.2))] # select high variance genes\n\n# remove any cell lines (rows) that contains NAs\nge_dat_hv <- ge_dat_hv |> na.omit()\n\n# standardize the data\nge_dat_hv <- scale(ge_dat_hv) |> as.data.frame()\n```\n:::\n\n\n## Hyperparameter Search\n\nWe use `h2o` to perform a grid search for the best autoencoder architecture.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Hyperparameter search grid to find best AE model\nh2o.init(nthreads = 20, max_mem_size = \"60G\")\nrna_h2o <- as.h2o(ge_dat_hv) # samples as rows, genes as columns\nhyper_grid <- list(hidden = list(\n  c(1000, 500, 1000),\n  c(1000, 500, 200, 500, 1000), \n  c(1000, 100, 50, 100, 1000),\n  c(1000, 500, 100, 500, 1000), \n  c(2000, 1000, 200, 1000, 2000), \n  c(1000, 500, 300, 500, 1000)\n))\nae_grid <- h2o.grid(\n  algorithm = \"deeplearning\",\n  x = colnames(rna_h2o), # genes as features\n  training_frame = rna_h2o,\n  grid_id = \"RNA_ae1\",\n  autoencoder = TRUE,\n  activation = \"TanhWithDropout\", \n  hyper_params = hyper_grid,\n  nesterov_accelerated_gradient = TRUE, \n  epochs = 30,\n  stopping_rounds = 5, \n  seed = 524\n)\n\n# Print grid details\nh2o.getGrid(\"RNA_ae1\", sort_by = \"mse\", decreasing = FALSE)\n```\n:::\n\n\n## Model Training\n\nBased on the grid search, we train the final model with the selected hyperparameters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# AE learning with best parameters\nae_model <- h2o.deeplearning(\n  x = colnames(rna_h2o), # genes as features\n  training_frame = rna_h2o,\n  autoencoder = TRUE,\n  hidden = c(1000, 500, 200, 500, 1000),\n  hidden_dropout_ratios = c(0.5, 0.5, 0.5, 0.5, 0.5),\n  activation = \"TanhWithDropout\",\n  epochs = 30,\n  stopping_rounds = 5, \n  nesterov_accelerated_gradient = TRUE, \n  seed = 524\n)\n\n# extract the compressed features\ncompressed_features <- h2o.deepfeatures(ae_model, rna_h2o, layer = 3) |> as.data.frame()\nrownames(compressed_features) <- rownames(ge_dat_hv)\n\nh2o.shutdown()\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}